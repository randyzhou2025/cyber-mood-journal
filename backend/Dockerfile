FROM node:18-alpine

WORKDIR /app

# 1ï¸âƒ£ æ‹·è´ä¾èµ–æè¿°
COPY package*.json ./

# 2ï¸âƒ£ å®‰è£…ä¾èµ–
RUN npm ci

# 3ï¸âƒ£ æ‹·è´æºç ï¼ˆåŒ…æ‹¬ prisma/schema.prismaï¼‰
COPY . .

# 4ï¸âƒ£ ç”Ÿæˆ Prisma Clientï¼ˆğŸ”¥å…³é”®ï¼‰
RUN npx prisma generate

# 5ï¸âƒ£ æ„å»º NestJSï¼ˆTS â†’ distï¼‰
RUN npm run build

# 6ï¸âƒ£ ç”Ÿäº§ç¯å¢ƒ
ENV NODE_ENV=production

# 7ï¸âƒ£ æš´éœ²ç«¯å£
EXPOSE 3001

# 8ï¸âƒ£ å¯åŠ¨æœåŠ¡ï¼ˆæŒ‰ä½ é¡¹ç›®å®é™…å…¥å£ï¼‰
CMD ["node", "dist/main.js"]
